### Genome feature enrichment

R-loop broad peaks were called with `macs2` and then compared with genomic features using `assignGenomeAnnotation` from `homer`. 


```{r fig.height=4, fig.width=10}
anno_cats <- data.frame(
  "Annotation" = c('Intergenic', 'Simple_repeat', 'Satellite', 'Promoter', 'pseudo', 'Intron', 'TTS', 'LINE', 'LTR', 'SINE', 'DNA', 'CpG-Island', 'ncRNA', 'Low_complexity', 'Exon', 'snRNA', 'Retroposon', '5UTR', '3UTR', 'srpRNA', 'tRNA', 'RC', 'scRNA', 'miRNA', 'RNA', 'snoRNA'),
  "annotate_type" = c("gene", "rep", "rep", "gene", "RNA", "gene", "gene", 
             "rep", "rep", "rep", "rep", "gene", "RNA", "rep",
             "gene", "RNA", "rep", "gene", "gene", "RNA",
             "RNA", "RNA", "RNA", "RNA", "RNA", "RNA"), stringsAsFactors = FALSE
)


anno_data_plt <- anno_data %>%
  dplyr::inner_join(y = anno_cats, by = "Annotation")

minplt <- min(anno_data_plt$`Log2 Ratio (obs/exp)`) * 1.05
maxplt <- max(anno_data_plt$`Log2 Ratio (obs/exp)`) * 1.05

# TODO: Add average to this with SEM
plt1 <- anno_data_plt %>%
  dplyr::filter(annotate_type == "gene") %>%
  ggplot2::ggplot(mapping = ggplot2::aes(x = factor(.data$Annotation, 
                                                    levels = c("CpG-Island",
                                                         "Promoter",
                                                         "5UTR",
                                                         "Exon",
                                                         "Intron",
                                                         "3UTR",
                                                         "TTS",
                                                         "Intergenic")), 
                                         y = .data$`Log2 Ratio (obs/exp)`)) +
  ggplot2::geom_col(fill = "firebrick") +
  ggplot2::ylab("Log2 Enrichment (obs/exp)") +
  ggplot2::xlab(NULL) +
  ggplot2::labs(title = "Genomic Features") +
  ggplot2::theme_bw() +
  ggplot2::theme(axis.text.x = ggplot2::element_text(angle = 45, vjust = 0.5,
                                                     hjust = 1)) +
  ggplot2::ylim(minplt, maxplt)

plt2 <- anno_data_plt %>%
  dplyr::filter(annotate_type == "RNA") %>%
  ggplot2::ggplot(mapping = ggplot2::aes(x = .data$Annotation,
                       y = .data$`Log2 Ratio (obs/exp)`)) +
  ggplot2::geom_col(fill = "goldenrod") +
  ggplot2::ylab(NULL) +
  ggplot2::xlab("Annotation") +
  ggplot2::labs(title = "ncRNAs") +
  ggplot2::theme_bw() + 
  ggplot2::theme(axis.text.x = ggplot2::element_text(angle = 45, vjust = 0.5,
                                                     hjust = 1)) +
  ggplot2::ylim(minplt, maxplt)

plt3 <- anno_data_plt %>%
  dplyr::filter(annotate_type == "rep") %>%
  ggplot2::ggplot(mapping = ggplot2::aes(x = .data$Annotation, 
                                y = .data$`Log2 Ratio (obs/exp)`)) +
  ggplot2::geom_col(fill = "forestgreen") +
  ggplot2::ylab(NULL) +
  ggplot2::xlab(NULL) +
  ggplot2::labs(title = "Repetitive Elements") +
  ggplot2::theme_bw() +
  ggplot2::theme(axis.text.x = ggplot2::element_text(angle = 45, vjust = 0.5,
                                                     hjust = 1)) +
  ggplot2::ylim(minplt, maxplt)

gt1 <- ggplot2::ggplotGrob(plt1)
gt2 <- ggplot2::ggplotGrob(plt2)
gt3 <- ggplot2::ggplotGrob(plt3)
if (length(plt2$data$Annotation) && length(plt3$data$Annotation)) {
  plts <- cbind(gt1, gt2, gt3, size = "last")
} else if (length(plt2$data$Annotation)) {
  plts <- cbind(gt1, gt2, size = "last")
} else {
  plts <- gt1
}
grid::grid.newpage()
grid::grid.draw(plts)
```


***
